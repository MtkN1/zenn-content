---
title: "レガシーなデプロイ"
---

この章ではレガシーなデプロイコンセプトを概要のみ紹介します。

## ローカル環境

初めの章で紹介したように、ローカルで次のコマンドを実行して PC の電源を付けっぱなしにしておく事で「bot を稼働させる」という目的自体は達成できます。

![](https://storage.googleapis.com/zenn-user-upload/427d60900661-20231214.png)

非常にシンプルで手っ取り早いです。 多くの人は VS Code などのターミナルが統合されているエディタを利用していると思いますので、そこでコマンドを実行する (もしくは実行ボタンを押す) だけです。 しかし、パッと思いつく限りでも様々な問題があります。

- **可用性**
    - 🤔 PC の電源を付けっぱなしにしておかなくてはいけない。
    - 🤔 PC をシャットダウンしたら bot も停止する。
    - 🤔 PC のスペックを超える処理を行うことができない。
- **ネットワーキング**
    - 🤔 通信が個人のインターネット環境に左右される。
- **モニタリング**
    - 🤔 出先などで外部から bot のログ確認や一時停止等の管理を行うことが難しい。
- **可搬性**
    - 🤔 ライブラリなどがローカルの環境に依存している場合、別環境で bot が実行できない可能性がある。

開発中にローカルで一時的に実行してテストするというぐらいのケースであれば問題ないのですが、実際に継続的に bot を稼働させようとすることは難しいです。

その為、既にクラウド環境を利用している botter は多いかと思います。 クラウド環境を利用することで主に可用性やネットワーキングの問題を解決することができます。

## クラウド環境

所謂 AWS EC2 のようなクラウド上の仮想マシンで bot を実行します。

https://aws.amazon.com/jp/ec2/

仮想マシンを利用するには、AWS であれば EC2 インスタンスを作成する必要があります。 こちらは AWS のユーザーガイドによるインスタンス作成手順の GIF アニメーションですが、普段から AWS を利用している方はこのようにインスタンスの作成には手馴れている方も多いのではないでしょうか。

![](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/images/tutorial-launch-instance.gif)

https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/option3-task1-launch-ec2-instance.html

クラウド環境でのデプロイコンセプトとしては、ローカル環境で行っていた作業を同じことを仮想マシンで実行するだけです。 ※仮想マシンの環境構築が必要です。

仮想マシンには通常 **SSH** 接続を利用します。 AWS とローカルで適切な設定を行ったら、ローカルから ssh コマンドで仮想マシンに接続することで作業を行うことができます。

![](https://storage.googleapis.com/zenn-user-upload/59682f6b72d5-20231215.png)

また VS Code であれば SSH 拡張機能が存在するので、**VS Code 上で仮想マシンに接続してローカル環境と同じようにコード編集して bot を実行することが可能**です。

![](https://code.visualstudio.com/assets/docs/remote/ssh-tutorial/debug-view.png)

https://code.visualstudio.com/docs/remote/ssh

この本を書く 2 年前にこのコンセプトについての詳しい手順を note で書きました。

https://note.com/mtkn1/n/nbc33e765558b

### nohup と tmux

仮想マシン自体は常時稼働し続けていますが、コマンドを実行中の状態で SSH 接続を抜けるとそのコマンドは終了してしまいます。 それを避けるために `nuhup` や `tmux` コマンドを利用します。

これについてはこの本を書く半年前に note を書きました。 前半で nohup や tmux を解説しています。 後半についてはこの本の草案的な内容となっているので斜め読み推奨です。

https://note.com/mtkn1/n/n1bc508855801

以上でクラウド環境の仮想マシンにおいて bot をデプロイできるようになりました 🚀

## まとめ

クラウド環境を利用することで、ローカルと比較して以下の課題を解決できます。 しかし解決できない課題もあります。

- **可用性**
    - ✅ PC の電源を付けっぱなしにしなくても bot を常時稼働できる。
- **ネットワーキング**
    - ✅ 個人のインターネット環境に左右されない。
- **モニタリング**
    - 🤔 外部から bot のログ確認や一時停止等の管理を行うことはまだ簡単ではない。
- **可搬性**
    - 🤔 別のリージョンで bot を稼働させたい場合など、ライブラリなどが環境に依存している場合、環境構築が容易ではない。
